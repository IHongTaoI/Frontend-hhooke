(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{226:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"手写自动化部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手写自动化部署"}},[s._v("#")]),s._v(" 🍧 手写自动化部署")]),s._v(" "),t("h2",{attrs:{id:"一、搭建git服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、搭建git服务器"}},[s._v("#")]),s._v(" 💥 一、搭建git服务器")]),s._v(" "),t("blockquote",[t("p",[s._v("本人使用的是 cenos 系统的腾讯云服务器")])]),s._v(" "),t("hr"),s._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"_1-服务器安装git"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-服务器安装git"}},[s._v("#")]),s._v(" 1. "),t("strong",[s._v("服务器安装git")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])])]),t("p",[s._v("安装完了之后使用命令查看版本，检验是否安装成功。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --version\n")])])])]),s._v(" "),t("li",[t("h3",{attrs:{id:"_2-创建一个系统用户进行git仓库的管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建一个系统用户进行git仓库的管理"}},[s._v("#")]),s._v(" 2. "),t("strong",[s._v("创建一个系统用户进行git仓库的管理")])]),s._v(" "),t("p",[s._v("我起的是 htgit(先检测这个用户是否存在)")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_183_60_centos hongtao"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# id htgit")]),s._v("\n")])])]),t("p",[s._v("如果存在会出现:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htgit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htgit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("groups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htgit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("如果不存在则提示")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("id: htgit: no such user\n")])])]),t("p",[s._v("就可以创建用户了,输入以下命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" htgit\n")])])]),t("p",[s._v("创建完成使用"),t("code",[s._v("id htgit")]),s._v("检测是否创建成功")])]),s._v(" "),t("li",[t("h3",{attrs:{id:"_3-创建项目仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建项目仓库"}},[s._v("#")]),s._v(" 3. "),t("strong",[s._v("创建项目仓库")])]),s._v(" "),t("p",[s._v("创建一个项目文件夹")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件夹名字"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如我的是")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p mypro\n")])])]),t("p",[s._v("创建git仓库")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p myblog.git\n")])])]),t("p",[s._v("初始化git仓库")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init --bare myblog.git\n")])])]),t("p",[s._v("使用 "),t("code",[s._v("ll")]),s._v("命令查看目录信息")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 myblog.git\n")])])]),t("p",[s._v("myblog.git 是归属root用户的，现在修改成我们之前新建的htgit用户。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R htgit:htgit myblog.git\n")])])]),t("p",[s._v("服务器拉取服务器git仓库的代码")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone ./myblog.git\n")])])]),t("p",[t("code",[s._v("ll")]),s._v("查看当前文件夹")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("drwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root  root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34 myblog\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" htgit htgit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26 myblog.git\n")])])]),t("blockquote",[t("p",[s._v("注意：把"),t("code",[s._v("myblog")]),s._v("目录也要改成"),t("code",[s._v("htgit")]),s._v("用户的权限，否则git钩子在操作的时候会没有权限")])])])]),s._v(" "),t("h2",{attrs:{id:"二、配置sshd-免密码连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、配置sshd-免密码连接"}},[s._v("#")]),s._v(" 💥 二、配置sshd 免密码连接")]),s._v(" "),t("hr"),s._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"_1-服务器上建立ssh验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-服务器上建立ssh验证"}},[s._v("#")]),s._v(" 1. "),t("strong",[s._v("服务器上建立ssh验证")])]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("cd ~htgit")]),s._v(" 或者 "),t("code",[s._v("cd /home/htgit")]),s._v(" 进入到我们htgit的用户目录,创建.ssh文件夹。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" .ssh\n")])])]),t("p",[s._v("更改权限")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R htgit:htgit .ssh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" .ssh\n")])])]),t("p",[s._v("进入.ssh/")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" .ssh\n")])])]),t("p",[s._v("创建 authorized_keys")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" authorized_keys\n")])])]),t("blockquote",[t("p",[s._v("一会需要将客户端的公钥填写到这个文件上")])]),s._v(" "),t("p",[s._v("更改此文件的权限")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" authorized_keys\n")])])])]),s._v(" "),t("li",[t("h3",{attrs:{id:"_2-客户端配置ssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-客户端配置ssh"}},[s._v("#")]),s._v(" 2. "),t("strong",[s._v("客户端配置ssh")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen -t rsa -C "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的邮箱'")]),s._v("\n")])])]),t("p",[s._v("如果之前创建过直接使用就行了")]),s._v(" "),t("blockquote",[t("p",[s._v("本人客户端是 windows 系统")])]),s._v(" "),t("p",[s._v("找到系统盘下一般是\n"),t("code",[s._v("C:\\Users\\用户名\\.ssh")]),s._v("的"),t("code",[s._v("id_rsa.pub")]),s._v("文件。用编辑器将它打开，将里面的内容复制到之前我们在服务器上创建的那个authorized_keys文件里去。")])])]),s._v(" "),t("h2",{attrs:{id:"三、创建客户端本地项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、创建客户端本地项目"}},[s._v("#")]),s._v(" 💥 三、创建客户端本地项目")]),s._v(" "),t("hr"),s._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"_1-客户端拉取代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-客户端拉取代码"}},[s._v("#")]),s._v(" 1. "),t("strong",[s._v("客户端拉取代码")])]),s._v(" "),t("p",[s._v("比如我是在window系统上，你得安装了git，打开git bash， 输入之前我们在服务器装的git仓库的路径")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone htgit@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("你的服务器ip地址"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("你的git仓库路径"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("比如我的:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone htgit@139.199.72.20:/usr/hongtao/myblog.git\n")])])])]),s._v(" "),t("li",[t("h3",{attrs:{id:"_2-配置本地代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置本地代码"}},[s._v("#")]),s._v(" 2. "),t("strong",[s._v("配置本地代码")])]),s._v(" "),t("p",[s._v("本人还是以iview-admin项目为例子")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/iview/iview-admin",target:"_blank",rel:"noopener noreferrer"}},[s._v("iview-admin代码地址"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("进入上一步骤我们"),t("code",[s._v("git clone")]),s._v("下来的目录"),t("code",[s._v("myblog")]),s._v("里")]),s._v(" "),t("p",[s._v("这里我就不做演示了，直接将iview-admin的代码拷贝进来。然后提交上传")])]),s._v(" "),t("li",[t("h3",{attrs:{id:"_3-服务器运行代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务器运行代码"}},[s._v("#")]),s._v(" 3. "),t("strong",[s._v("服务器运行代码")])]),s._v(" "),t("p",[s._v("上一步的操作使得我们服务器上的 "),t("code",[s._v("myblog.git")]),s._v("仓库上有了我们客户端推送过来的代码了，之前我们在服务器上 "),t("code",[s._v("git clone ./myblog.git")]),s._v("的时候也生成了一个myblog的文件夹。进入这个文件夹输入"),t("code",[s._v("git pull")]),s._v("即可获取当前服务器git仓库的最新代码。然后执行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run dev\n")])])]),t("p",[s._v("之后即可在服务器跑起来了。")]),s._v(" "),t("p",[s._v("到了这一步之后我们便知道了如何手动的去运行前端代码了。")]),s._v(" "),t("p",[s._v("在服务器上运行前端项目有很多种方式。如：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("nginx静态资源服务器")])]),s._v(" "),t("li",[t("p",[s._v("nodeJs服务器")])]),s._v(" "),t("li",[t("p",[s._v("php服务")])]),s._v(" "),t("li",[t("p",[s._v("。。。等等")]),s._v(" "),t("blockquote",[t("p",[s._v("本文以nodejs运行的前端项目为例子。直接使用webpack的热更新运行项目。")])])])])])]),s._v(" "),t("h2",{attrs:{id:"四、编写git钩子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、编写git钩子"}},[s._v("#")]),s._v(" 💥 四、编写git钩子")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("进入我们的服务器git仓库文件夹里")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/hongtao/myblog.git\n")])])]),t("p",[s._v("该目录下有一个hooks目录"),t("code",[s._v("cd hooks")]),s._v("进入")]),s._v(" "),t("p",[s._v("编写一个叫post-receive的文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" post-receive\n")])])]),t("p",[s._v("写入如下内容")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/hongtao/myblog\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'服务器代码更新'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("unset")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" rev-parse --local-env-vars"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch --all\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" reset --hard origin/master\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),t("p",[s._v("添加可执行权限")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x post-receive\n")])])]),t("p",[s._v("每当我们客户端提交一次代码，这个钩子就会运行一次。由于我们的前端代码是热更新的作用，当代码更新了，我们直接访问的就是我们最新的页面。")]),s._v(" "),t("p",[s._v("如有问题请联系 qq：836717428")])])}),[],!1,null,null,null);a.default=n.exports}}]);